<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, user-scalable=yes">

    <script src="../../webcomponentsjs/webcomponents-lite.js"></script>
    <script src="../../web-component-tester/browser.js"></script>

    <!-- Step 1: import the element to test -->
    <link rel="import" href="../stone-cart.html">
  </head>
  <body>

    <test-fixture id="CartAddBtn">
      <template>
        <stone-cart-add-btn item='{"id":1}'>Add to cart</stone-cart-add-btn>
      </template>
    </test-fixture>

    <test-fixture id="CartRemoveBtn">
      <template>
        <stone-cart-remove-btn item='{"id":1}'>Remove from cart</stone-cart-remove-btn>
      </template>
    </test-fixture>

    <script>
      suite('stone cart buttons', function() {
        var btn, item = {id: 1};

        suite('basic usage', function() {
          setup(function() {
            btn = fixture('CartAddBtn');
          });

          test('the button exposes the id of the related item', function() {
            expect(btn.itemId).to.equal(1);
          });

          test('the button is aware that its item is in the cart', function() {
            btn.cartItems = [{id: 1}];

            expect(btn.selected).to.equal(true);
          });
        });

        suite('<stone-cart-add-btn>', function() {
          setup(function() {
            btn = fixture('CartAddBtn');
          });

          suite('when adding the item to the cart', function() {
            setup(function() {
              btn.addItem();
            });

            test('the item is added to the cart', function() {
              expect(btn.cartItems.length).to.equal(1);
            });

            test('the button is aware that its item is in the cart', function() {
              expect(btn.selected).to.equal(true);
            });
          });

          suite('when the added item gets removed from the cart', function() {
            setup(function() {
              btn.cartItems = [item];

              btn.splice('cartItems', 0, 1);
            });

            test('the button is aware that its item is not in the cart anymore', function() {
              expect(btn.selected).to.equal(false);
            });
          });
        });

        suite('<stone-cart-remove-btn>', function() {
          setup(function() {
            btn = fixture('CartRemoveBtn');
          });

          suite('when removing the item from the cart', function() {
            setup(function() {
              btn.cartItems = [item];

              btn.removeItem();
            });

            test('the item is removed from the cart', function() {
              expect(btn.cartItems.length).to.equal(0);
            });

            test('the button is aware that its item is not in the cart anymore', function() {
              expect(btn.selected).to.equal(false);
            });
          });

          suite('when the item gets added to the cart', function() {
            setup(function() {
              btn.push('cartItems', item);
            });

            test('the button is aware that its item is in the cart', function() {
              expect(btn.selected).to.equal(true);
            });
          });
        });
      });
    </script>
  </body>
</html>
